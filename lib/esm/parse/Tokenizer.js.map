{"version":3,"file":"Tokenizer.js","sources":["../../../src/parse/Tokenizer.js"],"sourcesContent":["import {\n  MissingArgument,\n  InvalidArgument,\n  InvalidVcard,\n} from \"../errors/index.js\";\n\nexport class Tokenizer {\n  static identifier = \"Tokenizer\";\n\n  #_unfoldedVcard;\n\n  //Credit for the following regex goes to Jonas Hermsmeier, who got it from Jeff Roberson and added capture groups\n  #uriRegExp = new RegExp(\n    \"([A-Za-z][A-Za-z0-9+\\\\-.]*):(?:(//)(?:((?:[A-Za-z0-9\\\\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*)@)?((?:\\\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\\\.[A-Za-z0-9\\\\-._~!$&'()*+,;=:]+)\\\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\\\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*))(?::([0-9]*))?((?:/(?:[A-Za-z0-9\\\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)|/((?:(?:[A-Za-z0-9\\\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:/(?:[A-Za-z0-9\\\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?)|((?:[A-Za-z0-9\\\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:/(?:[A-Za-z0-9\\\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)|)(?:\\\\?((?:[A-Za-z0-9\\\\-._~!$&'()*+,;=:@/?]|%[0-9A-Fa-f]{2})*))?(?:\\\\#((?:[A-Za-z0-9\\\\-._~!$&'()*+,;=:@/?]|%[0-9A-Fa-f]{2})*))?\"\n  );\n\n  get numberOfVcards() {\n    return (this.#_unfoldedVcard.match(/BEGIN:VCARD\\r\\n/gi) ?? []).length || 1;\n  }\n\n  #backCount(chr, str) {\n    if (typeof chr === \"undefined\" || typeof str === \"undefined\")\n      throw new MissingArgument(\n        \"Character and string for this.#backCount must be supplied\"\n      );\n\n    if (typeof chr !== \"string\" || typeof str !== \"string\")\n      throw new InvalidArgument(\n        \"Character and string for this.#backCount must be of type string\"\n      );\n\n    let count = 0;\n\n    for (let index = str.length - 1; index >= 0; index--) {\n      if (str[index] === chr) count++;\n      else break;\n    }\n\n    return count;\n  }\n\n  #separateVcardContentLines() {\n    if (this.numberOfVcards === 1)\n      return this.#_unfoldedVcard.split(\"\\r\\n\").filter((vcard) => vcard !== \"\");\n\n    return this.#_unfoldedVcard\n      .split(/BEGIN:VCARD\\r\\n/gi)\n      .filter((vcard) => vcard !== \"\")\n      .map((vcard) =>\n        (\"BEGIN:VCARD\\r\\n\" + vcard)\n          .split(\"\\r\\n\")\n          .filter((vcard) => vcard !== \"\")\n      );\n  }\n\n  #valueSeparator(value) {\n    if (value.startsWith('\"') && value.endsWith('\"'))\n      value = value.slice(1, -1);\n\n    if (this.#uriRegExp.test(value)) return value;\n\n    const quotedValues = [];\n    let quotedValueIndex = 0;\n    for (let index = 0; index < value.length; index++) {\n      if (value[index] === '\"') {\n        const backslashCount = this.#backCount(\"\\\\\", value.slice(0, index));\n\n        if (backslashCount % 2 !== 0) continue;\n\n        if (typeof quotedValues[quotedValueIndex] !== \"object\")\n          quotedValues[quotedValueIndex] = {\n            start: index,\n          };\n        else if (typeof quotedValues[quotedValueIndex] === \"object\") {\n          quotedValues[quotedValueIndex][\"stop\"] = index;\n          quotedValueIndex++;\n        }\n      }\n    }\n\n    let parsedValue = [];\n\n    let continueFrom = 0;\n    for (let index = 0; index < value.length; index++) {\n      if (value[index] === \";\") {\n        if (\n          quotedValues.some((quotedValue) => {\n            return index > quotedValue.start && index < quotedValue.stop;\n          })\n        )\n          continue;\n\n        const backslashCount = this.#backCount(\n          \"\\\\\",\n          value.substring(continueFrom, index)\n        );\n        if (backslashCount % 2 !== 0) continue;\n\n        parsedValue.push(value.substring(continueFrom, index));\n        continueFrom = index + 1;\n      }\n\n      if (index === value.length - 1)\n        parsedValue.push(value.substring(continueFrom));\n    }\n\n    for (let index = 0; index < parsedValue.length; index++) {\n      const component = parsedValue[index];\n\n      const quotedComponents = [];\n      let quotedComponentIndex = 0;\n      for (let index = 0; index < component.length; index++) {\n        if (component[index] === '\"') {\n          const backslashCount = this.#backCount(\n            \"\\\\\",\n            component.slice(0, index)\n          );\n\n          if (backslashCount % 2 !== 0) continue;\n\n          if (typeof quotedComponents[quotedComponentIndex] !== \"object\")\n            quotedComponents[quotedComponentIndex] = {\n              start: index,\n            };\n          else if (typeof quotedComponents[quotedComponentIndex] === \"object\") {\n            quotedComponents[quotedComponentIndex][\"stop\"] = index;\n            quotedComponentIndex++;\n          }\n        }\n      }\n\n      const holdParsedComponent = [];\n      let continueFrom = 0;\n      for (let index2 = 0; index2 < component.length; index2++) {\n        if (component[index2] === \",\") {\n          if (\n            quotedComponents.some((quotedComponent) => {\n              return (\n                index2 > quotedComponent.start && index2 < quotedComponent.stop\n              );\n            })\n          )\n            continue;\n\n          const backslashCount = this.#backCount(\n            \"\\\\\",\n            component.substring(continueFrom, index2)\n          );\n          if (backslashCount % 2 !== 0) continue;\n\n          holdParsedComponent.push(component.substring(continueFrom, index2));\n          continueFrom = index2 + 1;\n        }\n\n        if (index2 === component.length - 1)\n          holdParsedComponent.push(component.substring(continueFrom));\n      }\n\n      if (holdParsedComponent.length > 1)\n        parsedValue[index] = holdParsedComponent;\n    }\n\n    parsedValue = parsedValue.map((val) => {\n      if (!Array.isArray(val))\n        return val\n          .replaceAll(\"\\\\n\", \"\\n\")\n          .replaceAll(\"\\\\;\", \";\")\n          .replaceAll(\"\\\\:\", \":\")\n          .replaceAll(\"\\\\,\", \",\")\n          .replaceAll(\"\\\\\\\\\", \"\\\\\");\n\n      return val.map((innerVal) =>\n        innerVal\n          .replaceAll(\"\\\\n\", \"\\n\")\n          .replaceAll(\"\\\\;\", \";\")\n          .replaceAll(\"\\\\:\", \":\")\n          .replaceAll(\"\\\\,\", \",\")\n          .replaceAll(\"\\\\\\\\\", \"\\\\\")\n      );\n    });\n\n    return parsedValue.length > 1 ? parsedValue : parsedValue[0];\n  }\n\n  #parametersSeparator(params) {\n    const paramList = [];\n\n    const quotedParams = [];\n    let quotedParamIndex = 0;\n    for (let index = 0; index < params.length; index++) {\n      if (params[index] === '\"') {\n        const backslashCount = this.#backCount(\"\\\\\", params.slice(0, index));\n\n        if (backslashCount % 2 !== 0) continue;\n\n        if (typeof quotedParams[quotedParamIndex] !== \"object\")\n          quotedParams[quotedParamIndex] = {\n            start: index,\n          };\n        else if (typeof quotedParams[quotedParamIndex] === \"object\") {\n          quotedParams[quotedParamIndex][\"stop\"] = index;\n          quotedParamIndex++;\n        }\n      }\n    }\n\n    let continueFrom = 0;\n    for (let index = 0; index < params.length; index++) {\n      if (params[index] === \";\") {\n        if (\n          quotedParams.some((quotedParam) => {\n            return index > quotedParam.start && index < quotedParam.stop;\n          })\n        )\n          continue;\n\n        const backslashCount = this.#backCount(\n          \"\\\\\",\n          params.substring(continueFrom, index)\n        );\n        if (backslashCount % 2 !== 0) continue;\n\n        paramList.push(params.substring(continueFrom, index));\n        continueFrom = index + 1;\n      }\n\n      if (index === params.length - 1)\n        paramList.push(params.substring(continueFrom));\n    }\n\n    const refParamList = [...paramList];\n    for (let index = 0; index < paramList.length; index++) {\n      const joinedParam = paramList[index];\n\n      const holdJoinedParam = [];\n      let continueFrom = 0;\n      for (let index2 = 0; index2 < joinedParam.length; index2++) {\n        if (joinedParam[index2] === \"=\") {\n          const actualIndex = index\n            ? (() => {\n                let count = 0;\n\n                for (let index3 = 0; index3 < index; index3++) {\n                  count += refParamList[index3][\"length\"];\n                  count++; //for removed semicolon\n                }\n\n                count += index2;\n\n                return count;\n              })()\n            : index2;\n          if (\n            quotedParams.some((quotedParam) => {\n              return (\n                actualIndex > quotedParam.start &&\n                actualIndex < quotedParam.stop\n              );\n            })\n          )\n            continue;\n\n          const backslashCount = this.#backCount(\n            \"\\\\\",\n            joinedParam.substring(continueFrom, index2)\n          );\n          if (backslashCount % 2 !== 0) continue;\n\n          holdJoinedParam.push(joinedParam.substring(continueFrom, index2));\n          continueFrom = index2 + 1;\n        }\n\n        if (index2 === joinedParam.length - 1)\n          holdJoinedParam.push(joinedParam.substring(continueFrom));\n      }\n\n      const parsedParam = {};\n      for (let index = 0; index < holdJoinedParam.length; index++) {\n        if (index % 2 === 0)\n          parsedParam[holdJoinedParam[index]] = holdJoinedParam[index + 1];\n        else continue;\n      }\n\n      paramList[index] = parsedParam;\n    }\n\n    for (let index = 0; index < paramList.length; index++) {\n      const currentParam = paramList[index];\n      const currentParamKey = Object.keys(currentParam).pop();\n      const currentParamValue = Object.values(currentParam).pop();\n\n      let holdCurrentParamValue = \"\";\n      let continueFrom = 0;\n      for (let index2 = 0; index2 < currentParamValue.length; index2++) {\n        if (currentParamValue[index2] === \"^\") {\n          const circumflexCount = this.#backCount(\n            \"^\",\n            currentParamValue.substring(continueFrom, index2)\n          );\n\n          if (circumflexCount % 2 !== 0) {\n            holdCurrentParamValue += currentParamValue[index2];\n          } else {\n            switch (true) {\n              case currentParamValue[index2 + 1] === \"n\":\n                holdCurrentParamValue += \"\\n\";\n                index2++;\n                break;\n              case currentParamValue[index2 + 1] === \"â€™\":\n                holdCurrentParamValue += '\"';\n                index2++;\n                break;\n              case currentParamValue[index2 + 1] === \"^\":\n                holdCurrentParamValue += \"^\";\n                index2++;\n                break;\n            }\n          }\n        } else {\n          holdCurrentParamValue += currentParamValue[index2];\n        }\n        continueFrom = index2 + 1;\n      }\n\n      if (\n        holdCurrentParamValue.startsWith('\"') &&\n        holdCurrentParamValue.endsWith('\"') &&\n        !this.#uriRegExp.test(holdCurrentParamValue.slice(1, -1))\n      )\n        holdCurrentParamValue = this.#valueSeparator(\n          holdCurrentParamValue.slice(1, -1)\n        );\n      else if (\n        holdCurrentParamValue.startsWith('\"') &&\n        holdCurrentParamValue.endsWith('\"')\n      )\n        holdCurrentParamValue = holdCurrentParamValue.slice(1, -1);\n\n      if (Array.isArray(holdCurrentParamValue))\n        holdCurrentParamValue = holdCurrentParamValue.map((val) =>\n          val\n            .replaceAll(\"\\\\n\", \"\\n\")\n            .replaceAll(\"\\\\;\", \";\")\n            .replaceAll(\"\\\\:\", \":\")\n            .replaceAll(\"\\\\,\", \",\")\n            .replaceAll(\"\\\\\\\\\", \"\\\\\")\n        );\n      else\n        holdCurrentParamValue = holdCurrentParamValue\n          .replaceAll(\"\\\\n\", \"\\n\")\n          .replaceAll(\"\\\\;\", \";\")\n          .replaceAll(\"\\\\:\", \":\")\n          .replaceAll(\"\\\\,\", \",\")\n          .replaceAll(\"\\\\\\\\\", \"\\\\\");\n\n      currentParam[currentParamKey] = holdCurrentParamValue;\n    }\n\n    return paramList.reduce((accumulatedParams, currentParam) => {\n      const key = Object.keys(currentParam)[0].toUpperCase();\n      const value = Object.values(currentParam)[0];\n      accumulatedParams[key] = value;\n      return accumulatedParams;\n    }, {});\n  }\n\n  #contentLineTokenizer(contentLine) {\n    const firstSemiColonIndex = contentLine.indexOf(\";\");\n    let firstColonIndex = contentLine.indexOf(\":\");\n\n    const propEndPoint =\n      firstSemiColonIndex !== -1\n        ? firstColonIndex < firstSemiColonIndex\n          ? firstColonIndex\n          : firstSemiColonIndex\n        : firstColonIndex;\n\n    let property = contentLine.slice(0, propEndPoint);\n    let group = null;\n\n    if (property.indexOf(\".\") !== -1) {\n      [group, property] = property.split(\".\");\n    }\n\n    if (firstSemiColonIndex === -1 || firstColonIndex < firstSemiColonIndex)\n      return {\n        group,\n        property: property.toUpperCase(),\n        parameters: {},\n        value: this.#valueSeparator(contentLine.slice(propEndPoint + 1)),\n      };\n\n    const quotedParts = [];\n    let quotedPartsIndex = 0;\n    for (let index = 0; index < contentLine.length; index++) {\n      if (contentLine[index] === '\"') {\n        const backslashCount = this.#backCount(\n          \"\\\\\",\n          contentLine.slice(0, index)\n        );\n\n        if (backslashCount % 2 !== 0) continue;\n\n        if (typeof quotedParts[quotedPartsIndex] !== \"object\") {\n          quotedParts[quotedPartsIndex] = {\n            start: index,\n          };\n        } else {\n          quotedParts[quotedPartsIndex][\"stop\"] = index;\n          quotedPartsIndex++;\n        }\n      }\n    }\n\n    if (\n      quotedParts.some(\n        (part) => part.start < firstColonIndex && part.stop > firstColonIndex\n      )\n    )\n      for (let index = firstColonIndex; index < contentLine.length; index++) {\n        if (contentLine[index] === \":\") {\n          if (\n            quotedParts.some((part) => part.start < index && part.stop > index)\n          )\n            continue;\n          else {\n            firstColonIndex = index;\n            break;\n          }\n        }\n      }\n\n    return {\n      group,\n      property: property.toUpperCase(),\n      parameters: this.#parametersSeparator(\n        contentLine.slice(firstSemiColonIndex + 1, firstColonIndex)\n      ),\n      value: this.#valueSeparator(contentLine.slice(firstColonIndex + 1)),\n    };\n  }\n\n  #initialValidation(vcard) {\n    if (typeof vcard === \"undefined\")\n      throw new MissingArgument(\"vCard to be tokenized must be supplied\");\n    else if (typeof vcard !== \"string\")\n      throw new TypeError(\"vCard to be tokenized must be of type string\");\n\n    if ((vcard.match(/\\r\\n/g) ?? []).length < 4)\n      throw new InvalidVcard(\n        \"vCard content lines must be delimited by CRLF (\\\\r\\\\n) sequence\"\n      );\n  }\n\n  get tokens() {\n    const tokens = [];\n\n    if (this.numberOfVcards === 1) {\n      for (const contentLine of this.#separateVcardContentLines())\n        tokens.push(this.#contentLineTokenizer(contentLine));\n    } else {\n      for (const vcard of this.#separateVcardContentLines()) {\n        const _cardTokens = [];\n\n        for (const contentLine of vcard)\n          _cardTokens.push(this.#contentLineTokenizer(contentLine));\n\n        tokens.push(_cardTokens);\n      }\n    }\n\n    return tokens;\n  }\n\n  constructor(vcard) {\n    this.#initialValidation(vcard);\n    this.#_unfoldedVcard = vcard.replace(/\\r\\n[\\t ]/g, \"\"); //unfold\n\n    Object.freeze(this);\n  }\n}\n\nObject.freeze(Tokenizer);\n"],"names":["_unfoldedVcard","WeakMap","_uriRegExp","_backCount","WeakSet","_separateVcardContentLines","_valueSeparator","_parametersSeparator","_contentLineTokenizer","_initialValidation","Tokenizer","vcard","_classCallCheck","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","writable","value","RegExp","_classPrivateMethodGet","_initialValidation2","call","_classPrivateFieldSet","replace","Object","freeze","_createClass","key","get","_classPrivateFieldGet2","_classPrivateFieldGet","match","length","tokens","numberOfVcards","_iterator","_createForOfIteratorHelper","_separateVcardContentLines2","_step","s","n","done","contentLine","push","_contentLineTokenizer2","err","e","f","_iterator2","_step2","_cardTokens","_iterator3","_step3","_backCount2","chr","str","MissingArgument","InvalidArgument","count","index","split","filter","map","_valueSeparator2","_this","startsWith","endsWith","slice","test","quotedValues","quotedValueIndex","backslashCount","_typeof","start","parsedValue","continueFrom","_loop","_index","some","quotedValue","stop","substring","_ret","component","quotedComponents","quotedComponentIndex","holdParsedComponent","_loop2","index2","quotedComponent","_ret2","val","Array","isArray","replaceAll","innerVal","_parametersSeparator2","params","_this2","paramList","quotedParams","quotedParamIndex","_loop3","_index4","quotedParam","_ret3","refParamList","concat","_loop4","_index5","joinedParam","holdJoinedParam","_loop5","_index7","actualIndex","index3","_ret4","parsedParam","currentParam","currentParamKey","keys","pop","currentParamValue","values","holdCurrentParamValue","circumflexCount","reduce","accumulatedParams","toUpperCase","firstSemiColonIndex","indexOf","firstColonIndex","propEndPoint","property","group","_property$split","_property$split2","_slicedToArray","parameters","quotedParts","quotedPartsIndex","part","_loop6","_index9","_ret5","_vcard$match","TypeError","InvalidVcard","_defineProperty"],"mappings":"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"}